{% extends "base.html" %}
{% load static %}

{% block titles %}
    Techlink | Perfil
{% endblock %}


{% block styles %}

{% endblock %}


{% block content %}

<main class="w-full">
  <div class="h-[280px] w-full absolute" style="background-color: #FDFCF6;">
    <div class="w-2/3 mx-auto bg-white border border-gray-300 relative top-25">
      <div class="flex lg:justify-between flex-col lg:flex-row items-center py-6 px-10 gap-4 lg:gap-0">
        <div class="flex gap-5 items-center">
          {% if usuario.foto_perfil %}
              <img 
              src="{% if usuario.foto_perfil %}{{ usuario.foto_perfil.url }}{% else %}{% static 'img/default-avatar.jpg' %}{% endif %}"  
              alt="Imagem perfil" 
              class="h-[100px] w-[100px] rounded-full object-cover">
          {% endif %}
          
          <span class="text-gray-900 text-xl font-semibold">{{usuario.nome}} {{usuario.sobrenome}}</span>
        </div>
        <div>
          <button class="bg-red-100 text-red-800 py-4 px-6 font-semibold flex gap-3 items-center cursor-pointer hover:bg-red-400 transition duration-300">Seja um instrutor <i class="fa-solid fa-arrow-right" style="color: #9E0000;"></i></button>
        </div>
      </div>

      <div class="flex items-center w-full justify-center border-b border-t border-gray-200 md:gap-32 gap-8">
            <button class="tab-button text-gray-500 font-medium py-3 px-6 border-b-2 border-transparent transition-colors duration-300 cursor-pointer">
                Instrutores
            </button>
            
            <button class="tab-button text-gray-900 font-medium py-3 px-6 border-b-2 border-red-500 transition-colors duration-300 cursor-pointer">
                Configurações
            </button>
      </div>
      
    </div>
  </div>

  <div>
    <h2 class="font-semibold text-gray-900 text-2xl">Configurações</h2>
    
    <!-- Formulário de dados pessoais -->
    <div class="w-2/3 mx-auto bg-white border border-gray-300 mt-72 p-10 mb-10">
      <h2 class="text-2xl font-semibold mb-6">Editar Conta</h2>
      
            <form method="post" enctype="multipart/form-data" class="flex-1 w-full">
        {% csrf_token %}
        <div class="flex flex-col md:flex-row gap-8 w-full">
            <!-- Coluna da foto -->
            <div class="flex flex-col items-center md:w-1/3">
                <div class="image-upload-container">
                    <div class="relative">
                        <img 
                            id="image-preview"
                            src="{% if usuario.foto_perfil %}{{ usuario.foto_perfil.url }}{% else %}{% static 'img/default-avatar.jpg' %}{% endif %}" 
                            alt="Foto de Perfil"
                            class="profile-pic mb-2">

                        <label for="{{ profile_form.foto_perfil.id_for_label }}" class="upload-label">
                            <i class="fa-solid fa-arrow-up-from-bracket"></i> <span>Escolher foto</span>
                        </label>

                        <input type="file"
                            accept="image/*"
                            name="{{ profile_form.foto_perfil.name }}"
                            id="{{ profile_form.foto_perfil.id_for_label }}"
                            class="hidden-file-input"
                            onchange="previewImage(this)">
                    </div>
                    {% if profile_form.foto_perfil.errors %}
                        <p class="text-red-600 text-sm mt-2">{{ profile_form.foto_perfil.errors }}</p>
                    {% endif %}
                </div>
            </div>
            <!-- Coluna dos demais campos -->
            <div class="flex-1">
                <div class="flex gap-6 mb-4">
                    <div class="flex-1">
                        <label for="{{ profile_form.nome.id_for_label }}" class="text-gray-900">Nome</label>
                        {{ profile_form.nome }}
                        {% if profile_form.nome.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ profile_form.nome.errors.as_text }}</p>
                        {% endif %}
                    </div>
                    <div class="flex-1">
                        <label for="{{ profile_form.sobrenome.id_for_label }}" class="text-gray-900">Sobrenome</label>
                        {{ profile_form.sobrenome }}
                        {% if profile_form.sobrenome.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ profile_form.sobrenome.errors.as_text }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="mb-4">
                    <label for="{{ profile_form.num_celular.id_for_label }}" class="text-gray-900">Telefone</label>
                    {{ profile_form.num_celular }}
                    {% if profile_form.num_celular.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ profile_form.num_celular.errors.as_text }}</p>
                    {% endif %}
                </div>
                <div class="mb-6">
                    <label for="{{ profile_form.email.id_for_label }}" class="text-gray-900">Email</label>
                    {{ profile_form.email }}
                    {% if profile_form.email.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ profile_form.email.errors.as_text }}</p>
                    {% endif %}
                </div>
                <button type="submit" name="submit_perfil" class="py-4 px-6 bg-red-900 text-white font-medium flex gap-3 items-center cursor-pointer hover:bg-red-800 transition duration-300">
                    Salvar
                </button>
            </div>
        </div>
    </form>
    </div>

    <!-- Formulário de alteração de senha -->
    <div class="w-2/3 mx-auto bg-white border border-gray-300 p-10 mb-10">
      <h2 class="text-2xl font-semibold mb-6">Trocar senha</h2>
      <form method="post" class="space-y-4">
        {% csrf_token %}
        {{ password_form.non_field_errors }}

        <div>
            <label class="block text-sm font-medium text-gray-700">Senha atual</label>
            {{ password_form.old_password }}
            {{ password_form.old_password.errors }}
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Nova senha</label>
            {{ password_form.new_password1 }}
            {{ password_form.new_password1.errors }}
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700">Confirme a nova senha</label>
            {{ password_form.new_password2 }}
            {{ password_form.new_password2.errors }}
        </div>

        <button type="submit" name="submit_password" class="bg-yellow-600 text-white py-2 px-4 rounded hover:bg-yellow-700">Alterar Senha</button>
      </form>
    </div>

    <!-- Formulário de dados de professor -->
    <div class="w-2/3 mx-auto bg-white border border-gray-300 p-10 mb-10">
      <h2 class="text-2xl font-semibold mb-6">Editar Perfil de Professor</h2>

      <form method="post" class="space-y-4">
        {% csrf_token %}
        {{ professor_form.non_field_errors }}

        <div>
          <label class="block text-sm font-medium text-gray-700">Formação:</label>
          {{ professor_form.formacao }}
          {{ professor_form.formacao.errors }}
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Apresentação:</label>
          {{ professor_form.apresentacao }}
          {{ professor_form.apresentacao.errors }}
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Valor Hora:</label>
          {{ professor_form.valor_hora }}
          {{ professor_form.valor_hora.errors }}
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Áreas de Conhecimento:</label>
          {{ professor_form.areas_conhecimento }}
          {{ professor_form.areas_conhecimento.errors }}
        </div>

        <div class="pt-4">
          <button type="submit" name="submit_professor" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">Salvar Perfil de Professor</button>
        </div>
      </form>
    </div>
  </div>
</main>

<script>

  document.addEventListener('DOMContentLoaded', function() {
    // Seleciona os elementos do DOM
    const fileInput = document.getElementById('{{ profile_form.foto_perfil.id_for_label }}');

    const imagePreview = document.getElementById('image-preview');

    // Verifica se os elementos existem na página
    if (fileInput && imagePreview) {
        // Adiciona um "ouvinte" para o evento 'change' no input de arquivo
        fileInput.addEventListener('change', function(event) {
            // Pega o primeiro arquivo selecionado pelo usuário
            const file = event.target.files[0];

            // Se um arquivo foi realmente selecionado...
            if (file) {
                // Cria um objeto FileReader para ler o arquivo
                const reader = new FileReader();

                // Define o que acontece quando o arquivo terminar de ser lido
                reader.onload = function(e) {
                    // Atualiza o atributo 'src' da tag <img> com o resultado da leitura
                    // O resultado é uma string Base64 que representa a imagem
                    imagePreview.src = e.target.result;
                };

                // Pede ao FileReader para ler o arquivo como uma URL de dados (Base64)
                reader.readAsDataURL(file);
            }
        });
    }
});
        // 1. Seleciona todos os botões que têm a classe 'tab-button'
        const tabButtons = document.querySelectorAll('.tab-button');

        // Classes que definem o estado ATIVO
        const activeClasses = ['border-red-500', 'text-gray-900'];
        // Classes que definem o estado INATIVO
        const inactiveClasses = ['border-transparent', 'text-gray-500'];

        // 2. Adiciona um "ouvinte" de clique para cada botão
        tabButtons.forEach(clickedButton => {
            clickedButton.addEventListener('click', () => {
                
                // 3. Remove o estado ativo de TODOS os botões
                tabButtons.forEach(button => {
                    button.classList.remove(...activeClasses);
                    button.classList.add(...inactiveClasses);
                });
                
                // 4. Adiciona o estado ativo APENAS ao botão que foi clicado
                clickedButton.classList.remove(...inactiveClasses);
                clickedButton.classList.add(...activeClasses);
            });
        });
</script>
{% endblock %}

